<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>UniCamillus Biology Trainer</title>
  <style>
    :root {
      color-scheme: dark;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, #020617, #000000);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      color: #e5e7eb;
    }
    .app {
      width: 100%;
      max-width: 900px;
      background: #020617ee;
      border-radius: 24px;
      border: 1px solid #1f2937;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      padding: 16px 16px 20px;
    }
    @media (min-width: 768px){
      .app { padding: 20px 24px 24px; }
    }
    h1 { margin: 0 0 4px; font-size: 1.4rem; }
    .sub { font-size: 0.8rem; color: #9ca3af; }

    .top-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    .pill-group {
      display: inline-flex;
      padding: 3px;
      border-radius: 999px;
      background: #020617;
    }
    .pill {
      border-radius: 999px;
      border: none;
      background: transparent;
      padding: 6px 10px;
      font-size: 0.75rem;
      color: #e5e7eb;
    }
    .pill.active {
      background: #22c55e;
      color: #020617;
      font-weight: 600;
    }

    .screen { margin-top: 10px; display: none; }
    .screen.active { display: block; }

    .card {
      background: #020617cc;
      border-radius: 16px;
      border: 1px solid #1f2937;
      padding: 12px;
      margin-bottom: 10px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      background: #22c55e;
      color: #020617;
      padding: 10px 14px;
      font-size: 0.9rem;
      font-weight: 600;
      width: 100%;
      margin-top: 8px;
    }
    .btn.secondary {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #374151;
      font-weight: 500;
    }
    .btn:disabled {
      background: #1f2937;
      color: #6b7280;
    }

    .topic-box-title {
      font-size: 0.8rem;
      color: #9ca3af;
      margin: 6px 0 4px;
    }
    .topic-buttons, .difficulty-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .topic-btn, .difficulty-btn {
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.75rem;
      padding: 5px 10px;
    }
    .topic-btn.active, .difficulty-btn.active {
      background: #22c55e;
      color: #020617;
      border-color: #22c55e;
      font-weight: 600;
    }

    .q-header {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #22c55e66;
      background: #22c55e22;
      color: #6ee7b7;
      margin-bottom: 4px;
    }
    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }
    .q-text { font-size: 1rem; line-height: 1.5; }

    .options {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .opt-btn {
      border-radius: 14px;
      border: 1px solid #1f2937;
      background: #020617;
      padding: 8px 10px;
      font-size: 0.9rem;
      display: flex;
      gap: 6px;
      align-items: flex-start;
      text-align: left;
    }
    .opt-btn.correct {
      border-color: #22c55e;
      background: #22c55e22;
      color: #bbf7d0;
    }
    .opt-btn.wrong {
      border-color: #f97373;
      background: #f9737322;
      color: #fecaca;
    }
    .opt-btn.selected:not(.correct):not(.wrong) {
      border-color: #22c55e;
    }
    .letter {
      font-size: 0.7rem;
      color: #9ca3af;
      margin-top: 3px;
      min-width: 16px;
    }
    .state-tag {
      margin-left: auto;
      font-size: 0.7rem;
      opacity: 0.8;
    }

    .stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
      font-size: 0.8rem;
      color: #9ca3af;
    }
    .progress-outer {
      margin-top: 8px;
      height: 6px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
    }
    .progress-inner {
      height: 100%;
      width: 0%;
      background: #22c55e;
      transition: width 0.2s ease;
    }

    ul.review-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 380px;
      overflow-y: auto;
    }
    ul.review-list li {
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid #111827;
      font-size: 0.85rem;
    }
    .tag-wrong  { color:#fecaca; font-size:0.75rem; }
    .tag-correct{ color:#bbf7d0; font-size:0.75rem; }
    .tag-exp    { color:#9ca3af; font-size:0.75rem; margin-top:2px; }

    .foot {
      margin-top: 10px;
      font-size: 0.7rem;
      color: #6b7280;
    }
  </style>
</head>
<body>
<div class="app">
  <div class="top-row">
    <div>
      <h1>UniCamillus Biology Trainer</h1>
      <p class="sub" id="subtitle">
        分野と難易度を選んで、最大10問ずつ生物（細胞・分子・遺伝子発現など）をトレーニングできます。
      </p>
    </div>
    <div>
      <div class="pill-group">
        <button class="pill active" id="lang-ja">日本語</button>
        <button class="pill" id="lang-en">English</button>
      </div>
    </div>
  </div>

  <!-- ホーム画面 -->
  <div id="screen-home" class="screen active">
    <div class="card">
      <p id="home-text">
        まず分野と難易度を選び、「10問テスト」を押してください。
        選んだ範囲からランダムに最大10問出題されます。
      </p>

      <p class="topic-box-title" id="topic-title">分野を選択:</p>
      <div id="topic-buttons" class="topic-buttons"></div>

      <p class="topic-box-title" id="diff-title">難易度を選択:</p>
      <div id="difficulty-buttons" class="difficulty-buttons"></div>

      <div class="stats-row" id="last-session-row" style="display:none;">
        <span id="last-score-text"></span>
        <span id="last-date-text"></span>
      </div>
    </div>

    <button class="btn" id="btn-start-main">選んだ条件で10問テスト</button>
    <button class="btn secondary" id="btn-start-review" disabled>
      復習モード（前回の間違えた問題）
    </button>
  </div>

  <!-- クイズ画面 -->
  <div id="screen-quiz" class="screen">
    <div class="card">
      <div class="q-header">
        <span id="q-counter">Q 1 / 10</span>
        <span id="q-topic"></span>
      </div>
      <div class="badge">
        <span class="badge-dot"></span>
        <span id="badge-text">レベル: 基礎</span>
      </div>
      <p class="q-text" id="q-text"></p>
    </div>

    <div class="card">
      <div id="options" class="options"></div>

      <button class="btn" id="btn-submit">回答する</button>
      <button class="btn" id="btn-next" style="display:none;">次の問題へ</button>
      <button class="btn secondary" id="btn-quit-home">
        ホームに戻る（この回は破棄）
      </button>

      <div id="explanation-box" style="display:none; margin-top:8px; font-size:0.85rem;">
        <strong id="exp-title">解説</strong>
        <div id="exp-body"></div>
      </div>

      <div class="stats-row">
        <span id="stat-correct">正解数: 0</span>
        <span id="stat-accuracy">正答率: 0%</span>
      </div>
      <div class="progress-outer">
        <div class="progress-inner" id="progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- 結果画面 -->
  <div id="screen-result" class="screen">
    <div class="card">
      <h2 id="result-title" style="margin:0 0 4px; font-size:1.1rem;">結果</h2>
      <p id="result-summary" style="margin:0 0 6px; font-size:0.9rem;"></p>
      <div class="stats-row">
        <span id="result-detail-1"></span>
        <span id="result-detail-2"></span>
      </div>
    </div>

    <div class="card" id="review-card" style="display:none;">
      <p style="font-size:0.85rem; margin:0 0 6px;" id="review-title">
        間違えた問題（解説つき）
      </p>
      <ul class="review-list" id="review-list"></ul>
    </div>

    <button class="btn" id="btn-restart-main">もう一度 10問テスト</button>
    <button class="btn secondary" id="btn-restart-review" disabled>
      間違えた問題だけで再テスト
    </button>
    <button class="btn secondary" id="btn-back-home">
      ホームに戻る
    </button>
  </div>

  <p class="foot" id="footer">
    このアプリは UniCamillus 医学部レベルの生物学（細胞生物学・分子生物学）を想定した自習用ツールです。
    成績データは端末内ローカルにのみ保存されます。
  </p>
</div>

<script>
  // ========= 状態 =========
  let lang = "ja";
  let selectedTopic = "all";     // all / cell / molecules / geneExp / protein / virus
  let selectedLevel = "all";     // all / basic / intermediate
  const TOTAL_PER_SESSION = 10;  // 1回の最大出題数

  let sessionQuestions = [];
  let sessionAnswers = [];
  let currentIndex = 0;
  let score = 0;
  let bestStreak = 0;
  let currentStreak = 0;
  let sessionTotal = TOTAL_PER_SESSION; // 実際に今回出題する問題数

  // ========= テキスト類 =========
  const TOPIC_DEFS = {
    all:      { ja:"全分野",             en:"All topics" },
    cell:     { ja:"細胞生物学",         en:"Cell biology" },
    molecules:{ ja:"生体分子",           en:"Biomolecules" },
    geneExp:  { ja:"遺伝子発現（DNA→RNA）", en:"Gene expression (DNA→RNA)" },
    protein:  { ja:"翻訳とタンパク質",   en:"Translation & proteins" },
    virus:    { ja:"ウイルス",           en:"Viruses" }
  };

  const LEVEL_DEFS = {
    all:         { ja:"全レベル", en:"All levels" },
    basic:       { ja:"基礎",     en:"Basic" },
    intermediate:{ ja:"応用",     en:"Intermediate" }
  };

  const TEXT = {
    subtitle:{
      ja:"分野と難易度を選んで、最大10問ずつ生物（細胞・分子・遺伝子発現など）をトレーニングできます。",
      en:"Choose topic and difficulty and practice biology in sessions of up to 10 questions."
    },
    homeText:{
      ja:"まず分野と難易度を選び、「10問テスト」を押してください。選んだ範囲からランダムに最大10問出題されます。",
      en:"Select topic and difficulty, then start the test. Up to 10 questions are drawn at random from the chosen pool."
    },
    topicTitle:{ ja:"分野を選択:", en:"Choose topic:" },
    diffTitle:{ ja:"難易度を選択:", en:"Choose difficulty:" },
    btnMain:{ ja:"選んだ条件で10問テスト", en:"Start 10-question test" },
    btnReview:{ ja:"復習モード（前回の間違えた問題）", en:"Review mode (missed questions)" },
    btnSubmit:{ ja:"回答する", en:"Submit answer" },
    btnNext:{ ja:"次の問題へ", en:"Next question" },
    btnQuitHome:{ ja:"ホームに戻る（この回は破棄）", en:"Back to home (discard this run)" },
    expTitle:{ ja:"解説", en:"Explanation" },
    statCorrect:{ ja:"正解数", en:"Correct" },
    statAccuracy:{ ja:"正答率", en:"Accuracy" },
    levelBasic:{ ja:"レベル: 基礎", en:"Level: Basic" },
    levelInter:{ ja:"レベル: 応用", en:"Level: Intermediate" },
    qCounter:{
      ja:(i,t)=>`問題 ${i} / ${t}`,
      en:(i,t)=>`Question ${i} / ${t}`
    },
    resultTitle:{ ja:"結果", en:"Result" },
    resultSummary:{
      ja:(s,p,t,l,n)=>`${TOPIC_DEFS[t].ja}・${LEVEL_DEFS[l].ja}：${n}問中 ${s} 問正解（${p}%）`,
      en:(s,p,t,l,n)=>`${TOPIC_DEFS[t].en} / ${LEVEL_DEFS[l].en}: ${s} of ${n} correct (${p}%).`
    },
    resultDetail1:{
      ja:(c)=>`連続正解のベスト: ${c}`,
      en:(c)=>`Best correct streak: ${c}`
    },
    resultDetail2:{
      ja:(w)=>`間違えた問題: ${w} 問`,
      en:(w)=>`Number of missed questions: ${w}`
    },
    reviewTitle:{
      ja:"間違えた問題（解説つき）",
      en:"Missed questions (with explanations)"
    },
    tagYour:{ ja:"あなたの回答", en:"Your answer" },
    tagCorrect:{ ja:"正解", en:"Correct answer" },
    footer:{
      ja:"このアプリは UniCamillus 医学部レベルの生物学（細胞生物学・分子生物学）を想定した自習用ツールです。成績は端末内ローカルに保存されます。",
      en:"This app targets UniCamillus-level cell & molecular biology. Scores are stored only on this device."
    },
    correctLabel:{ ja:"正解", en:"Correct" },
    wrongLabel:{ ja:"不正解", en:"Wrong" },
    btnRestartMain:{ ja:"もう一度 10問テスト", en:"Take another 10-question test" },
    btnRestartReview:{ ja:"間違えた問題だけで再テスト", en:"Retest missed questions only" },
    btnBackHome:{ ja:"ホームに戻る", en:"Back to home" }
  };

  // ========= 生物の問題バンク =========
  // topic: cell / molecules / geneExp / protein / virus
  // level: basic / intermediate
  const QUESTION_BANK = [
    // --- Cell biology 基礎 ---
    {
      id:"cell-01",
      topic:"cell",
      level:"basic",
      q:{
        ja:"『細胞説』として正しい内容の組み合わせはどれ？",
        en:"Which statement correctly belongs to the cell theory?"
      },
      choices:[
        {ja:"全ての細胞は無生物から自然発生する", en:"All cells arise spontaneously from nonliving matter"},
        {ja:"全ての生物は1個の巨大な細胞からできている", en:"All organisms consist of a single giant cell"},
        {ja:"全ての生物は1個以上の細胞から成り、細胞が生命の基本単位である", en:"All organisms are composed of one or more cells and the cell is the basic unit of life"},
        {ja:"遺伝情報はタンパク質にのみ保存される", en:"Genetic information is stored only in proteins"},
        {ja:"細胞はエネルギーを利用しない", en:"Cells do not use energy"}
      ],
      correct:2,
      exp:{
        ja:"細胞説では「全ての生物は1個以上の細胞から成り，細胞が生命の構造的・機能的単位である」とされる。",
        en:"Cell theory states that all organisms consist of one or more cells and that the cell is the structural and functional unit of life."
      }
    },
    {
      id:"cell-02",
      topic:"cell",
      level:"basic",
      q:{
        ja:"原核細胞と真核細胞の共通点として正しいのはどれ？",
        en:"Which feature is common to both prokaryotic and eukaryotic cells?"
      },
      choices:[
        {ja:"DNAは常に核膜で囲まれている", en:"DNA is always enclosed by a nuclear envelope"},
        {ja:"ATPをエネルギー通貨として利用する", en:"They use ATP as an energy currency"},
        {ja:"細胞骨格を全く持たない", en:"They lack any cytoskeleton"},
        {ja:"リボソームを持たない", en:"They lack ribosomes"},
        {ja:"細胞膜を持たない", en:"They lack a plasma membrane"}
      ],
      correct:1,
      exp:{
        ja:"原核・真核ともにATPをエネルギー通貨とし，細胞膜やリボソームなど多くの基本機能を共有している。",
        en:"Both cell types use ATP as an energy currency and share basic components like plasma membrane and ribosomes."
      }
    },
    {
      id:"cell-03",
      topic:"cell",
      level:"basic",
      q:{
        ja:"動物細胞で主にATPを産生する細胞小器官はどれ？",
        en:"Which organelle mainly produces ATP in animal cells?"
      },
      choices:[
        {ja:"ゴルジ体", en:"Golgi apparatus"},
        {ja:"ミトコンドリア", en:"Mitochondria"},
        {ja:"リソソーム", en:"Lysosomes"},
        {ja:"滑面小胞体", en:"Smooth endoplasmic reticulum"},
        {ja:"細胞核", en:"Nucleus"}
      ],
      correct:1,
      exp:{
        ja:"ミトコンドリアは酸化的リン酸化によりATPを大量に産生するため「細胞の発電所」と呼ばれる。",
        en:"Mitochondria produce large amounts of ATP by oxidative phosphorylation and are often called the powerhouses of the cell."
      }
    },
    {
      id:"cell-04",
      topic:"cell",
      level:"basic",
      q:{
        ja:"リソソームの主な役割として最も適切なのはどれ？",
        en:"What is the main role of lysosomes in animal cells?"
      },
      choices:[
        {ja:"ATPの産生", en:"ATP production"},
        {ja:"不要物や異物の分解", en:"Degradation of waste and foreign material"},
        {ja:"タンパク質合成", en:"Protein synthesis"},
        {ja:"mRNAの転写", en:"mRNA transcription"},
        {ja:"細胞骨格の形成", en:"Formation of cytoskeleton"}
      ],
      correct:1,
      exp:{
        ja:"リソソームは加水分解酵素を含み，細胞内の不要物や取り込まれた異物を分解する。",
        en:"Lysosomes contain hydrolytic enzymes and break down cellular waste and ingested material."
      }
    },
    {
      id:"cell-05",
      topic:"cell",
      level:"basic",
      q:{
        ja:"細胞膜のモデルとして広く受け入れられているものはどれ？",
        en:"Which model is widely accepted for the structure of the plasma membrane?"
      },
      choices:[
        {ja:"三重膜モデル", en:"Triple-layer model"},
        {ja:"モザイクモデル", en:"Mosaic model"},
        {ja:"流動モザイクモデル", en:"Fluid mosaic model"},
        {ja:"格子モデル", en:"Lattice model"},
        {ja:"単層脂質モデル", en:"Single-layer lipid model"}
      ],
      correct:2,
      exp:{
        ja:"細胞膜はリン脂質二重層中をタンパク質が動き回る『流動モザイクモデル』で説明される。",
        en:"The plasma membrane is described by the fluid mosaic model, with proteins moving within a phospholipid bilayer."
      }
    },
    // --- Cell biology 応用 ---
    {
      id:"cell-06",
      topic:"cell",
      level:"intermediate",
      q:{
        ja:"細胞の大きさが制限される主な理由として最も適切なのはどれ？",
        en:"What is the main reason why cells are typically small?"
      },
      choices:[
        {ja:"小さいほど拡散が遅くなるから", en:"Because diffusion becomes slower in smaller volumes"},
        {ja:"表面積/体積比が大きいほど物質交換に有利だから", en:"Because a high surface-area-to-volume ratio favors exchange of materials"},
        {ja:"DNAの量が細胞径を直接決めるから", en:"Because the amount of DNA strictly sets cell size"},
        {ja:"小さい細胞はATPを合成できないから", en:"Because small cells cannot make ATP"},
        {ja:"細胞膜は伸びないため大きくできないから", en:"Because membranes cannot stretch at all"}
      ],
      correct:1,
      exp:{
        ja:"細胞が大きくなると表面積/体積比が低下し，栄養や老廃物の交換が非効率になるため，多くの細胞は小さなサイズを保つ。",
        en:"If a cell becomes too large its surface-area-to-volume ratio decreases and exchange of materials becomes inefficient, so most cells remain small."
      }
    },
    {
      id:"cell-07",
      topic:"cell",
      level:"intermediate",
      q:{
        ja:"エンドサイトーシスに関する説明として正しいのはどれ？",
        en:"Which statement about endocytosis is correct?"
      },
      choices:[
        {ja:"細胞外への物質分泌の過程である", en:"It is the process of secreting materials out of the cell"},
        {ja:"細胞が膜をくびり込んで物質を取り込む過程である", en:"The cell engulfs materials by invaginating its membrane"},
        {ja:"ミトコンドリアでのみ起こる", en:"It occurs only in mitochondria"},
        {ja:"DNA複製と同義である", en:"It is synonymous with DNA replication"},
        {ja:"原核生物では決して起こらない", en:"It never occurs in any prokaryote"}
      ],
      correct:1,
      exp:{
        ja:"エンドサイトーシスは細胞膜が内側に陥入して小胞を形成し，細胞外物質を取り込む過程である。",
        en:"Endocytosis is the uptake of materials into the cell via invagination of the plasma membrane to form vesicles."
      }
    },
    {
      id:"cell-08",
      topic:"cell",
      level:"intermediate",
      q:{
        ja:"植物細胞に特有で，動物細胞には通常みられない構造はどれ？",
        en:"Which structure is typical of plant cells but usually absent in animal cells?"
      },
      choices:[
        {ja:"リボソーム", en:"Ribosomes"},
        {ja:"ゴルジ体", en:"Golgi apparatus"},
        {ja:"細胞壁", en:"Cell wall"},
        {ja:"滑面小胞体", en:"Smooth ER"},
        {ja:"ミトコンドリア", en:"Mitochondria"}
      ],
      correct:2,
      exp:{
        ja:"セルロースからなる細胞壁は植物細胞の特徴であり，動物細胞には通常存在しない。",
        en:"A cellulose-based cell wall is characteristic of plant cells and is not normally found in animal cells."
      }
    },

    // --- Biomolecules 基礎 ---
    {
      id:"mol-01",
      topic:"molecules",
      level:"basic",
      q:{
        ja:"生体分子の骨格として最も重要な元素はどれ？",
        en:"Which element forms the main backbone of most biological molecules?"
      },
      choices:[
        {ja:"ナトリウム", en:"Sodium"},
        {ja:"カルシウム", en:"Calcium"},
        {ja:"炭素", en:"Carbon"},
        {ja:"塩素", en:"Chlorine"},
        {ja:"マグネシウム", en:"Magnesium"}
      ],
      correct:2,
      exp:{
        ja:"炭素は4本の共有結合を作ることができ，多様な有機分子骨格を形成できる。",
        en:"Carbon makes four covalent bonds and allows enormous diversity of organic backbones."
      }
    },
    {
      id:"mol-02",
      topic:"molecules",
      level:"basic",
      q:{
        ja:"リン脂質の特徴を説明した文として正しいのはどれ？",
        en:"Which statement correctly describes a phospholipid?"
      },
      choices:[
        {ja:"完全に疎水性である", en:"It is completely hydrophobic"},
        {ja:"完全に親水性である", en:"It is completely hydrophilic"},
        {ja:"1本の脂肪酸鎖のみを持つ", en:"It has only one fatty acid chain"},
        {ja:"疎水性尾部と親水性頭部を併せ持つ両親媒性分子である", en:"It is amphipathic with hydrophobic tails and a hydrophilic head"},
        {ja:"細胞膜には含まれない", en:"It is not present in cell membranes"}
      ],
      correct:3,
      exp:{
        ja:"リン脂質は疎水性の脂肪酸尾部と親水性のリン酸頭部を持つ両親媒性分子で，脂質二重層の基本構成要素である。",
        en:"Phospholipids have hydrophobic fatty acid tails and a hydrophilic phosphate head, forming the basic structure of lipid bilayers."
      }
    },
    {
      id:"mol-03",
      topic:"molecules",
      level:"basic",
      q:{
        ja:"次のうち炭水化物に分類されるものはどれ？",
        en:"Which of the following is classified as a carbohydrate?"
      },
      choices:[
        {ja:"トリグリセリド", en:"Triglyceride"},
        {ja:"グルコース", en:"Glucose"},
        {ja:"ホスホリピド", en:"Phospholipid"},
        {ja:"ヘモグロビン", en:"Hemoglobin"},
        {ja:"DNA", en:"DNA"}
      ],
      correct:1,
      exp:{
        ja:"グルコースは単糖類であり，炭水化物の基本単位の一つである。",
        en:"Glucose is a monosaccharide and a basic unit of carbohydrates."
      }
    },
    {
      id:"mol-04",
      topic:"molecules",
      level:"basic",
      q:{
        ja:"アミノ酸を構成する官能基の組み合わせとして正しいのはどれ？",
        en:"Which combination of functional groups is characteristic of amino acids?"
      },
      choices:[
        {ja:"カルボキシル基とアミノ基", en:"Carboxyl group and amino group"},
        {ja:"アルデヒド基と水酸基", en:"Aldehyde group and hydroxyl group"},
        {ja:"ホスホジエステル基とメチル基", en:"Phosphodiester group and methyl group"},
        {ja:"スルフヒドリル基とカルボニル基のみ", en:"Only sulfhydryl and carbonyl groups"},
        {ja:"エステル基とエーテル基", en:"Ester and ether groups"}
      ],
      correct:0,
      exp:{
        ja:"アミノ酸は一般に1つのアミノ基（–NH₂）と1つのカルボキシル基（–COOH）をもつ。",
        en:"Amino acids characteristically contain one amino group (–NH₂) and one carboxyl group (–COOH)."
      }
    },
    {
      id:"mol-05",
      topic:"molecules",
      level:"basic",
      q:{
        ja:"酵素の一般的な特徴として正しいのはどれ？",
        en:"Which is a general feature of enzymes?"
      },
      choices:[
        {ja:"反応の活性化エネルギーを下げる", en:"They lower the activation energy of reactions"},
        {ja:"常に反応速度を遅くする", en:"They always slow down reactions"},
        {ja:"反応で消費されて二度と再利用されない", en:"They are consumed and never reused"},
        {ja:"全て脂質でできている", en:"All of them are lipids"},
        {ja:"温度の影響を受けない", en:"They are not affected by temperature"}
      ],
      correct:0,
      exp:{
        ja:"酵素は活性化エネルギーを下げることで反応速度を高める触媒として働く。",
        en:"Enzymes act as catalysts that increase reaction rates by lowering activation energy."
      }
    },

    // --- Biomolecules 応用 ---
    {
      id:"mol-06",
      topic:"molecules",
      level:"intermediate",
      q:{
        ja:"タンパク質の二次構造に含まれないものはどれ？",
        en:"Which is NOT considered a protein secondary structure?"
      },
      choices:[
        {ja:"αヘリックス", en:"α helix"},
        {ja:"βシート", en:"β sheet"},
        {ja:"ターン／ループ構造", en:"Turns/loops"},
        {ja:"ペプチド結合", en:"Peptide bond"},
        {ja:"ランダムコイル", en:"Random coil regions"}
      ],
      correct:3,
      exp:{
        ja:"ペプチド結合はアミノ酸同士をつなぐ一次構造の要素であり，二次構造そのものではない。",
        en:"The peptide bond is part of the primary structure that links amino acids; it is not itself a secondary structure."
      }
    },
    {
      id:"mol-07",
      topic:"molecules",
      level:"intermediate",
      q:{
        ja:"水の性質に関する記述として正しいのはどれ？",
        en:"Which statement about the properties of water is correct?"
      },
      choices:[
        {ja:"水素結合を形成しない", en:"It does not form hydrogen bonds"},
        {ja:"比熱容量が低いため温度変化しやすい", en:"It has a low specific heat capacity and changes temperature easily"},
        {ja:"優れた極性溶媒として多くのイオンや極性分子を溶かす", en:"It is a polar solvent that dissolves many ions and polar molecules"},
        {ja:"密度は固体の方が常に高い", en:"Its solid state is always denser than its liquid state"},
        {ja:"生体内でほとんど化学反応に関与しない", en:"It rarely participates in chemical reactions in cells"}
      ],
      correct:2,
      exp:{
        ja:"水は極性分子であり水素結合を形成し，多くのイオン・極性分子を溶かすため生体内の主要な溶媒となる。",
        en:"Water is polar and forms hydrogen bonds; it dissolves many ions and polar molecules, serving as the main solvent in cells."
      }
    },
    {
      id:"mol-08",
      topic:"molecules",
      level:"intermediate",
      q:{
        ja:"DNA二重らせんを安定化する結合として最も重要なのはどれ？",
        en:"Which interaction is most important in stabilizing the DNA double helix?"
      },
      choices:[
        {ja:"ペプチド結合", en:"Peptide bonds"},
        {ja:"リン酸エステル結合", en:"Phosphate ester bonds"},
        {ja:"塩基間の水素結合と塩基スタッキング", en:"Hydrogen bonds and base stacking"},
        {ja:"ジスルフィド結合", en:"Disulfide bonds"},
        {ja:"グリコシド結合", en:"Glycosidic bonds"}
      ],
      correct:2,
      exp:{
        ja:"相補的塩基間の水素結合と疎水的な塩基スタッキングがDNA二重らせんの安定化に重要である。",
        en:"Complementary base pairing via hydrogen bonds and hydrophobic base stacking together stabilize the DNA double helix."
      }
    },

    // --- Gene expression 基礎 ---
    {
      id:"gene-01",
      topic:"geneExp",
      level:"basic",
      q:{
        ja:"DNAからRNAが合成される過程を何と呼ぶ？",
        en:"What is the process called in which RNA is synthesized from DNA?"
      },
      choices:[
        {ja:"翻訳", en:"Translation"},
        {ja:"複製", en:"Replication"},
        {ja:"転写", en:"Transcription"},
        {ja:"スプライシング", en:"Splicing"},
        {ja:"フォールディング", en:"Folding"}
      ],
      correct:2,
      exp:{
        ja:"DNA鋳型からRNAポリメラーゼによってRNAを合成する過程は『転写』と呼ばれる。",
        en:"The synthesis of RNA from a DNA template by RNA polymerase is called transcription."
      }
    },
    {
      id:"gene-02",
      topic:"geneExp",
      level:"basic",
      q:{
        ja:"真核細胞で転写が主に起こる場所はどこ？",
        en:"Where does transcription mainly occur in eukaryotic cells?"
      },
      choices:[
        {ja:"細胞質", en:"Cytoplasm"},
        {ja:"ミトコンドリア膜", en:"Mitochondrial membrane"},
        {ja:"細胞核内", en:"Inside the nucleus"},
        {ja:"リソソーム", en:"Lysosomes"},
        {ja:"ゴルジ体", en:"Golgi apparatus"}
      ],
      correct:2,
      exp:{
        ja:"真核細胞ではDNAは核内に存在し，mRNAの転写も主に核内で行われる。",
        en:"In eukaryotic cells, DNA resides in the nucleus, and transcription of mRNA mainly occurs there."
      }
    },
    {
      id:"gene-03",
      topic:"geneExp",
      level:"basic",
      q:{
        ja:"セントラルドグマを最もよく表している流れはどれ？",
        en:"Which sequence best represents the central dogma of molecular biology?"
      },
      choices:[
        {ja:"タンパク質 → DNA → RNA", en:"Protein → DNA → RNA"},
        {ja:"DNA → タンパク質 → RNA", en:"DNA → Protein → RNA"},
        {ja:"DNA → RNA → タンパク質", en:"DNA → RNA → Protein"},
        {ja:"RNA → DNA → タンパク質", en:"RNA → DNA → Protein"},
        {ja:"タンパク質 → RNA → DNA", en:"Protein → RNA → DNA"}
      ],
      correct:2,
      exp:{
        ja:"セントラルドグマは「DNAからRNAが転写され，RNAからタンパク質が翻訳される」と表現される。",
        en:"The central dogma states that DNA is transcribed into RNA, which is then translated into protein."
      }
    },
    {
      id:"gene-04",
      topic:"geneExp",
      level:"basic",
      q:{
        ja:"RNAにおいてアデニン（A）と塩基対を形成する塩基はどれ？",
        en:"In RNA, which base pairs with adenine (A)?"
      },
      choices:[
        {ja:"チミン（T）", en:"Thymine (T)"},
        {ja:"ウラシル（U）", en:"Uracil (U)"},
        {ja:"シトシン（C）", en:"Cytosine (C)"},
        {ja:"グアニン（G）", en:"Guanine (G)"},
        {ja:"どの塩基とも対を作らない", en:"It does not pair with any base"}
      ],
      correct:1,
      exp:{
        ja:"RNAではチミンの代わりにウラシルが使われ，A-Uの塩基対を形成する。",
        en:"RNA uses uracil instead of thymine, forming A–U base pairs."
      }
    },

    // --- Gene expression 応用 ---
    {
      id:"gene-05",
      topic:"geneExp",
      level:"intermediate",
      q:{
        ja:"真核生物に特徴的なmRNAの成熟過程に含まれないものはどれ？",
        en:"Which step is NOT part of typical eukaryotic mRNA maturation?"
      },
      choices:[
        {ja:"5' キャップ付加", en:"Addition of a 5' cap"},
        {ja:"ポリアデニル化（poly(A) tail の付加）", en:"Polyadenylation (poly(A) tail)"},
        {ja:"イントロンのスプライシング", en:"Splicing of introns"},
        {ja:"メチル化されたtRNAへの結合", en:"Covalent binding to methylated tRNA"},
        {ja:"一部の塩基の編集（RNA editing）", en:"RNA editing of some bases"}
      ],
      correct:3,
      exp:{
        ja:"mRNA成熟にtRNAへの共有結合は含まれない。tRNAは翻訳でアミノ酸を運ぶ別の分子である。",
        en:"Binding to methylated tRNA is not part of mRNA maturation; tRNA is a separate molecule used in translation."
      }
    },
    {
      id:"gene-06",
      topic:"geneExp",
      level:"intermediate",
      q:{
        ja:"転写因子の主な役割として正しいのはどれ？",
        en:"What is the main role of transcription factors?"
      },
      choices:[
        {ja:"DNA複製の開始点を切断する", en:"To cut DNA at replication origins"},
        {ja:"リボソームに結合して翻訳を促進する", en:"To bind ribosomes and promote translation"},
        {ja:"特定の配列に結合して転写の開始や制御を行う", en:"To bind specific DNA sequences and regulate transcription initiation"},
        {ja:"mRNAを分解して発現を止める", en:"To degrade mRNA and stop expression"},
        {ja:"アミノ酸をtRNAに結合させる", en:"To attach amino acids to tRNAs"}
      ],
      correct:2,
      exp:{
        ja:"転写因子は特定のDNA配列に結合し，RNAポリメラーゼの結合や活性を調節して遺伝子発現を制御する。",
        en:"Transcription factors bind specific DNA sequences and regulate gene expression by controlling RNA polymerase recruitment and activity."
      }
    },
    {
      id:"gene-07",
      topic:"geneExp",
      level:"intermediate",
      q:{
        ja:"プロモーター領域の役割として最も適切なのはどれ？",
        en:"What is the main role of a promoter region in DNA?"
      },
      choices:[
        {ja:"翻訳開始位置を決める", en:"To determine the start of translation"},
        {ja:"スプライシング部位を形成する", en:"To form splicing sites"},
        {ja:"RNAポリメラーゼが結合し転写を開始する位置を決める", en:"To bind RNA polymerase and define where transcription begins"},
        {ja:"テロメアを延長する", en:"To extend telomeres"},
        {ja:"DNA二本鎖を接着する", en:"To glue together the two DNA strands"}
      ],
      correct:2,
      exp:{
        ja:"プロモーターはRNAポリメラーゼや転写因子が結合する領域で，転写開始位置を規定する。",
        en:"Promoters are DNA regions where RNA polymerase and transcription factors bind to initiate transcription."
      }
    },
    {
      id:"gene-08",
      topic:"geneExp",
      level:"intermediate",
      q:{
        ja:"イントロンとエクソンに関する説明として正しいのはどれ？",
        en:"Which statement correctly describes introns and exons?"
      },
      choices:[
        {ja:"イントロンは翻訳される領域でエクソンは除去される", en:"Introns are translated regions and exons are removed"},
        {ja:"両方ともスプライシング後にmRNAから除かれる", en:"Both are removed from mRNA after splicing"},
        {ja:"イントロンは非翻訳領域でスプライシングにより除かれる", en:"Introns are non-coding regions removed by splicing"},
        {ja:"エクソンはDNAにしか存在せずRNAには存在しない", en:"Exons exist only in DNA and not in RNA"},
        {ja:"イントロンは原核生物に多く見られる", en:"Introns are abundant mainly in prokaryotes"}
      ],
      correct:2,
      exp:{
        ja:"イントロンは転写されるがスプライシングで除かれ，エクソンがつながって成熟mRNAとなる。",
        en:"Introns are transcribed but removed by splicing, leaving exons joined together in mature mRNA."
      }
    },

    // --- Protein 基礎 ---
    {
      id:"prot-01",
      topic:"protein",
      level:"basic",
      q:{
        ja:"翻訳に直接関わる分子の組み合わせとして正しいのはどれ？",
        en:"Which set of molecules acts directly in translation?"
      },
      choices:[
        {ja:"DNA, RNAポリメラーゼ, ヒストン", en:"DNA, RNA polymerase, histones"},
        {ja:"mRNA, tRNA, リボソーム", en:"mRNA, tRNA, ribosomes"},
        {ja:"脂質, mRNA, ゴルジ体", en:"Lipids, mRNA, Golgi apparatus"},
        {ja:"リソソーム, tRNA, DNA", en:"Lysosomes, tRNA, DNA"},
        {ja:"ミトコンドリア, rRNA, DNAポリメラーゼ", en:"Mitochondria, rRNA, DNA polymerase"}
      ],
      correct:1,
      exp:{
        ja:"翻訳ではmRNA, アミノアシルtRNA, リボソームが協調してポリペプチド鎖を合成する。",
        en:"Translation uses mRNA as template, aminoacyl-tRNAs, and ribosomes to synthesize a polypeptide."
      }
    },
    {
      id:"prot-02",
      topic:"protein",
      level:"basic",
      q:{
        ja:"タンパク質の一次構造を決めるものはどれ？",
        en:"What determines the primary structure of a protein?"
      },
      choices:[
        {ja:"折りたたまれた三次構造", en:"The folded tertiary structure"},
        {ja:"アミノ酸の配列", en:"The sequence of amino acids"},
        {ja:"ジスルフィド結合の数", en:"The number of disulfide bonds"},
        {ja:"リン脂質との相互作用", en:"Interactions with phospholipids"},
        {ja:"糖鎖修飾のパターン", en:"Patterns of glycosylation"}
      ],
      correct:1,
      exp:{
        ja:"タンパク質の一次構造はアミノ酸配列そのものであり，その後の高次構造や機能を決定づける。",
        en:"The primary structure of a protein is its amino acid sequence, which largely determines higher-order structure and function."
      }
    },
    {
      id:"prot-03",
      topic:"protein",
      level:"basic",
      q:{
        ja:"アミノ酸がペプチド結合でつながった直後の一次構造の鎖を何と呼ぶ？",
        en:"What do we call the linear chain of amino acids linked by peptide bonds?"
      },
      choices:[
        {ja:"多糖", en:"Polysaccharide"},
        {ja:"ポリペプチド", en:"Polypeptide"},
        {ja:"ホスホリピド", en:"Phospholipid"},
        {ja:"グリコーゲン", en:"Glycogen"},
        {ja:"プリオン", en:"Prion"}
      ],
      correct:1,
      exp:{
        ja:"アミノ酸がペプチド結合で直線状に連なった分子はポリペプチドと呼ばれ，立体構造をとるとタンパク質となる。",
        en:"A linear chain of amino acids joined by peptide bonds is called a polypeptide, which folds into a functional protein."
      }
    },
    {
      id:"prot-04",
      topic:"protein",
      level:"basic",
      q:{
        ja:"粗面小胞体（RER）のリボソームで合成されるタンパク質は主にどこへ運ばれる？",
        en:"Proteins synthesized on ribosomes of the rough ER are mainly destined for which location?"
      },
      choices:[
        {ja:"細胞核内のみ", en:"Only inside the nucleus"},
        {ja:"細胞質にとどまる", en:"They remain in the cytosol"},
        {ja:"分泌経路や膜系（細胞外・膜タンパク質など）", en:"Secretory pathway and membranes (secreted and membrane proteins)"},
        {ja:"ミトコンドリアマトリックス", en:"Mitochondrial matrix"},
        {ja:"細胞骨格フィラメント", en:"Cytoskeletal filaments"}
      ],
      correct:2,
      exp:{
        ja:"粗面小胞体で合成されたタンパク質はゴルジ体を経て分泌タンパク質や膜タンパク質として運ばれることが多い。",
        en:"Proteins synthesized on rough ER ribosomes usually enter the secretory pathway and become secreted or membrane proteins."
      }
    },

    // --- Protein 応用 ---
    {
      id:"prot-05",
      topic:"protein",
      level:"intermediate",
      q:{
        ja:"タンパク質フォールディングに関して正しい記述はどれ？",
        en:"Which statement about protein folding is correct?"
      },
      choices:[
        {ja:"アミノ酸配列は構造と無関係である", en:"Amino acid sequence is unrelated to the final structure"},
        {ja:"すべてのタンパク質は自発的に正しく折りたたまれるためシャペロンは不要である", en:"All proteins fold correctly without chaperones"},
        {ja:"誤ったフォールディングは病気の原因になりうる", en:"Misfolded proteins can lead to disease"},
        {ja:"フォールディングは細胞質では起こらない", en:"Folding never occurs in the cytosol"},
        {ja:"タンパク質は常に完全にランダムな構造をとる", en:"Proteins always remain completely random in structure"}
      ],
      correct:2,
      exp:{
        ja:"プリオン病やアルツハイマー病など，多くの疾患で誤ったフォールディングや凝集が重要な要因となる。",
        en:"In diseases such as prion diseases and Alzheimer's, protein misfolding and aggregation play key roles."
      }
    },
    {
      id:"prot-06",
      topic:"protein",
      level:"intermediate",
      q:{
        ja:"タンパク質の高次構造を安定化する相互作用として含まれないものはどれ？",
        en:"Which interaction does NOT typically stabilize higher-order protein structure?"
      },
      choices:[
        {ja:"水素結合", en:"Hydrogen bonds"},
        {ja:"疎水性相互作用", en:"Hydrophobic interactions"},
        {ja:"ジスルフィド結合", en:"Disulfide bonds"},
        {ja:"イオン結合（塩橋）", en:"Ionic bonds (salt bridges)"},
        {ja:"ホスホジエステル結合による骨格形成", en:"Phosphodiester bonds forming the backbone"}
      ],
      correct:4,
      exp:{
        ja:"ホスホジエステル結合は主に核酸の骨格にみられ，タンパク質の高次構造を直接安定化する結合ではない。",
        en:"Phosphodiester bonds form the backbone of nucleic acids, not a typical stabilizing interaction in protein higher-order structure."
      }
    },
    {
      id:"prot-07",
      topic:"protein",
      level:"intermediate",
      q:{
        ja:"翻訳後修飾の例として最も適切なのはどれ？",
        en:"Which is an example of a post-translational modification?"
      },
      choices:[
        {ja:"DNAの複製", en:"Replication of DNA"},
        {ja:"mRNAへの5'キャップ付加", en:"Addition of a 5′ cap to mRNA"},
        {ja:"アミノ酸側鎖のリン酸化", en:"Phosphorylation of amino acid side chains"},
        {ja:"イントロンのスプライシング", en:"Splicing of introns"},
        {ja:"tRNAへのアミノ酸結合", en:"Charging tRNA with amino acids"}
      ],
      correct:2,
      exp:{
        ja:"リン酸化やアセチル化，糖鎖付加などはタンパク質が合成された後に起こる翻訳後修飾の代表例である。",
        en:"Phosphorylation, acetylation, and glycosylation are typical post-translational modifications of proteins."
      }
    },
    {
      id:"prot-08",
      topic:"protein",
      level:"intermediate",
      q:{
        ja:"分子シャペロンの主な役割として正しいのはどれ？",
        en:"What is the main role of molecular chaperones?"
      },
      choices:[
        {ja:"DNA鎖を切断して修復する", en:"To cut DNA strands for repair"},
        {ja:"タンパク質の正しいフォールディングを助ける", en:"To assist proteins in folding correctly"},
        {ja:"mRNAを翻訳から保護する", en:"To protect mRNA from translation"},
        {ja:"脂質二重層を合成する", en:"To synthesize lipid bilayers"},
        {ja:"ATPの産生を行う", en:"To produce ATP"}
      ],
      correct:1,
      exp:{
        ja:"分子シャペロンは新生ポリペプチドや変性したタンパク質が正しく折りたたまれるように補助する。",
        en:"Molecular chaperones help newly synthesized or misfolded polypeptides achieve their correct conformation."
      }
    },

    // --- Virus 基礎 ---
    {
      id:"virus-01",
      topic:"virus",
      level:"basic",
      q:{
        ja:"ウイルスの共通した特徴として正しいのはどれ？",
        en:"Which feature is common to all viruses?"
      },
      choices:[
        {ja:"自分自身でATPを大量に合成できる", en:"They can produce large amounts of ATP on their own"},
        {ja:"細胞膜と細胞質を必ず持つ", en:"They always have plasma membrane and cytoplasm"},
        {ja:"ゲノムとしてDNAかRNAのいずれかを持つ", en:"They have either DNA or RNA as their genome"},
        {ja:"リボソームを持ちタンパク質合成を自律的に行う", en:"They have ribosomes for independent protein synthesis"},
        {ja:"無生物との相互作用を持たない", en:"They have no interactions with nonliving matter"}
      ],
      correct:2,
      exp:{
        ja:"ウイルスはDNAまたはRNAをゲノムとして持つが，自前のリボソームやエネルギー産生系を欠き，宿主細胞に依存する。",
        en:"Viruses contain either DNA or RNA as their genome but lack their own ribosomes and energy production, depending on host cells."
      }
    },
    {
      id:"virus-02",
      topic:"virus",
      level:"basic",
      q:{
        ja:"エンベロープを持たないウイルスを何と呼ぶことが多い？",
        en:"How are viruses without an envelope often described?"
      },
      choices:[
        {ja:"裸のウイルス（ノンエンベロープウイルス）", en:"Naked or non-enveloped viruses"},
        {ja:"レトロウイルス", en:"Retroviruses"},
        {ja:"プロウイルス", en:"Proviruses"},
        {ja:"プリオン", en:"Prions"},
        {ja:"ビロイド", en:"Viroids"}
      ],
      correct:0,
      exp:{
        ja:"脂質二重膜であるエンベロープを持たないウイルスは，カプシドのみからなるため裸のウイルス（ノンエンベロープウイルス）と呼ばれる。",
        en:"Viruses lacking a lipid envelope and consisting only of a capsid are called naked or non-enveloped viruses."
      }
    },
    {
      id:"virus-03",
      topic:"virus",
      level:"basic",
      q:{
        ja:"バクテリオファージとはどのようなウイルスか？",
        en:"What is a bacteriophage?"
      },
      choices:[
        {ja:"真菌を感染させるウイルス", en:"A virus that infects fungi"},
        {ja:"細菌を感染させるウイルス", en:"A virus that infects bacteria"},
        {ja:"植物を感染させるウイルス", en:"A virus that infects plants"},
        {ja:"ヒトの免疫細胞だけを標的とするウイルス", en:"A virus that specifically targets human immune cells"},
        {ja:"ウイルス同士を感染させるウイルス", en:"A virus that infects other viruses"}
      ],
      correct:1,
      exp:{
        ja:"バクテリオファージ（ファージ）は細菌を宿主とするウイルスであり，細菌感染症の研究などで重要である。",
        en:"Bacteriophages (phages) are viruses that infect bacteria and are important tools in microbiology."
      }
    },
    {
      id:"virus-04",
      topic:"virus",
      level:"basic",
      q:{
        ja:"ウイルスの宿主域（ホストレンジ）とは何を指すか？",
        en:"What does the host range of a virus refer to?"
      },
      choices:[
        {ja:"ウイルスが生存できる温度範囲", en:"The temperature range in which a virus can survive"},
        {ja:"ウイルスが感染・増殖できる宿主の種類", en:"The types of hosts a virus can infect and replicate in"},
        {ja:"ウイルス粒子の大きさの分布", en:"The size distribution of viral particles"},
        {ja:"ゲノム長の範囲", en:"The range of genome lengths"},
        {ja:"感染に必要な時間", en:"The time required for infection"}
      ],
      correct:1,
      exp:{
        ja:"宿主域とは，そのウイルスが感染できる生物種や細胞の範囲を指す。",
        en:"The host range describes the spectrum of species or cell types that a virus can infect."
      }
    },

    // --- Virus 応用 ---
    {
      id:"virus-05",
      topic:"virus",
      level:"intermediate",
      q:{
        ja:"溶菌サイクルの特徴として最も適切なのはどれ？",
        en:"Which is a characteristic feature of the lytic cycle of a virus?"
      },
      choices:[
        {ja:"宿主ゲノムに組み込まれ潜伏する", en:"Integration into the host genome and latency"},
        {ja:"宿主細胞を破壊せずに子孫ウイルスを放出する", en:"Releasing progeny viruses without damaging the host cell"},
        {ja:"宿主細胞を破壊して多くのウイルス粒子を放出する", en:"Destroying the host cell and releasing many viral particles"},
        {ja:"宿主細胞内でのみDNA複製を阻害する", en:"Only inhibiting DNA replication in the host"},
        {ja:"常にエンベロープ形成を伴う", en:"Always involving envelope formation"}
      ],
      correct:2,
      exp:{
        ja:"溶菌サイクルではウイルス増殖の結果，宿主細胞が破壊され多数のウイルス粒子が放出される。",
        en:"In the lytic cycle, viral replication leads to lysis of the host cell and release of many virions."
      }
    },
    {
      id:"virus-06",
      topic:"virus",
      level:"intermediate",
      q:{
        ja:"レトロウイルスに特徴的な酵素はどれ？",
        en:"Which enzyme is characteristic of retroviruses?"
      },
      choices:[
        {ja:"DNAポリメラーゼI", en:"DNA polymerase I"},
        {ja:"DNAリガーゼ", en:"DNA ligase"},
        {ja:"逆転写酵素", en:"Reverse transcriptase"},
        {ja:"RNAヘリカーゼ", en:"RNA helicase"},
        {ja:"DNAメチルトランスフェラーゼ", en:"DNA methyltransferase"}
      ],
      correct:2,
      exp:{
        ja:"レトロウイルスは逆転写酵素を用いてRNAゲノムからDNAを合成し，宿主ゲノムに組み込む。",
        en:"Retroviruses use reverse transcriptase to synthesize DNA from their RNA genome, which is then integrated into the host genome."
      }
    }
  ];

  // ========= 共通ユーティリティ =========
  const screenHome   = document.getElementById("screen-home");
  const screenQuiz   = document.getElementById("screen-quiz");
  const screenResult = document.getElementById("screen-result");

  const subtitle     = document.getElementById("subtitle");
  const homeText     = document.getElementById("home-text");
  const topicTitle   = document.getElementById("topic-title");
  const diffTitle    = document.getElementById("diff-title");
  const topicButtonsDiv = document.getElementById("topic-buttons");
  const diffButtonsDiv  = document.getElementById("difficulty-buttons");

  const btnStartMain   = document.getElementById("btn-start-main");
  const btnStartReview = document.getElementById("btn-start-review");
  const btnRestartMain = document.getElementById("btn-restart-main");
  const btnRestartReview = document.getElementById("btn-restart-review");
  const btnBackHome    = document.getElementById("btn-back-home");
  const btnQuitHome    = document.getElementById("btn-quit-home");

  const qCounter   = document.getElementById("q-counter");
  const qTopic     = document.getElementById("q-topic");
  const badgeText  = document.getElementById("badge-text");
  const qText      = document.getElementById("q-text");
  const optionsDiv = document.getElementById("options");
  const btnSubmit  = document.getElementById("btn-submit");
  const btnNext    = document.getElementById("btn-next");

  const explanationBox = document.getElementById("explanation-box");
  const expTitle       = document.getElementById("exp-title");
  const expBody        = document.getElementById("exp-body");

  const statCorrect = document.getElementById("stat-correct");
  const statAccuracy= document.getElementById("stat-accuracy");
  const progressBar = document.getElementById("progress-bar");

  const resultTitle   = document.getElementById("result-title");
  const resultSummary = document.getElementById("result-summary");
  const resultDetail1 = document.getElementById("result-detail-1");
  const resultDetail2 = document.getElementById("result-detail-2");
  const reviewCard    = document.getElementById("review-card");
  const reviewTitle   = document.getElementById("review-title");
  const reviewList    = document.getElementById("review-list");

  const lastSessionRow= document.getElementById("last-session-row");
  const lastScoreText = document.getElementById("last-score-text");
  const lastDateText  = document.getElementById("last-date-text");
  const footer        = document.getElementById("footer");

  function showScreen(name){
    [screenHome,screenQuiz,screenResult].forEach(s=>s.classList.remove("active"));
    if(name==="home") screenHome.classList.add("active");
    if(name==="quiz") screenQuiz.classList.add("active");
    if(name==="result") screenResult.classList.add("active");
  }
  function shuffle(arr){
    const a=arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }
  function getStoredWrongIds(){
    try{
      const raw=localStorage.getItem("bio_last_wrong_ids");
      if(!raw) return [];
      const arr=JSON.parse(raw);
      return Array.isArray(arr)?arr:[];
    }catch{return [];}
  }
  function updateLastSession(){
    const scoreStored = localStorage.getItem("bio_last_score");
    const date  = localStorage.getItem("bio_last_date");
    if(!scoreStored || !date){
      lastSessionRow.style.display="none";
      btnStartReview.disabled = !getStoredWrongIds().length;
      return;
    }
    lastSessionRow.style.display="flex";
    const d=new Date(date);
    lastScoreText.textContent = (lang==="ja"?"前回のスコア: ":"Last score: ")+scoreStored+"%";
    lastDateText.textContent  = (lang==="ja"?"実施日: ":"Date: ")+d.toLocaleString();
    btnStartReview.disabled = !getStoredWrongIds().length;
  }

  function renderTopicButtons(){
    topicButtonsDiv.innerHTML="";
    Object.keys(TOPIC_DEFS).forEach(key=>{
      const b=document.createElement("button");
      b.className="topic-btn"+(key===selectedTopic?" active":"");
      b.textContent=TOPIC_DEFS[key][lang];
      b.onclick=()=>{selectedTopic=key;renderTopicButtons();};
      topicButtonsDiv.appendChild(b);
    });
  }
  function renderDiffButtons(){
    diffButtonsDiv.innerHTML="";
    Object.keys(LEVEL_DEFS).forEach(key=>{
      const b=document.createElement("button");
      b.className="difficulty-btn"+(key===selectedLevel?" active":"");
      b.textContent=LEVEL_DEFS[key][lang];
      b.onclick=()=>{selectedLevel=key;renderDiffButtons();};
      diffButtonsDiv.appendChild(b);
    });
  }

  function applyLanguage(){
    subtitle.textContent   = TEXT.subtitle[lang];
    homeText.textContent   = TEXT.homeText[lang];
    topicTitle.textContent = TEXT.topicTitle[lang];
    diffTitle.textContent  = TEXT.diffTitle[lang];
    btnStartMain.textContent   = TEXT.btnMain[lang];
    btnStartReview.textContent = TEXT.btnReview[lang];
    btnSubmit.textContent      = TEXT.btnSubmit[lang];
    btnNext.textContent        = TEXT.btnNext[lang];
    btnQuitHome.textContent    = TEXT.btnQuitHome[lang];
    btnRestartMain.textContent = TEXT.btnRestartMain[lang];
    btnRestartReview.textContent = TEXT.btnRestartReview[lang];
    btnBackHome.textContent    = TEXT.btnBackHome[lang];
    reviewTitle.textContent    = TEXT.reviewTitle[lang];
    footer.textContent         = TEXT.footer[lang];

    document.getElementById("lang-ja").classList.toggle("active",lang==="ja");
    document.getElementById("lang-en").classList.toggle("active",lang==="en");

    renderTopicButtons();
    renderDiffButtons();
    updateLastSession();

    if(screenQuiz.classList.contains("active")) renderQuestion();
    if(screenResult.classList.contains("active")) renderResult();
  }

  document.getElementById("lang-ja").onclick=()=>{lang="ja";applyLanguage();};
  document.getElementById("lang-en").onclick=()=>{lang="en";applyLanguage();};

  // ========= セッション開始 =========
  function startSession(mode){
    let pool;
    if(mode==="review"){
      const ids=getStoredWrongIds();
      pool=QUESTION_BANK.filter(q=>ids.includes(q.id));
      if(!pool.length) pool=QUESTION_BANK;
    } else {
      pool=QUESTION_BANK.filter(q=>{
        const topicOK = (selectedTopic==="all") || (q.topic===selectedTopic);
        const levelOK = (selectedLevel==="all") || (q.level===selectedLevel);
        return topicOK && levelOK;
      });
      if(!pool.length) pool=QUESTION_BANK;
    }

    // 実際に今回出す問題数：プールが10問未満ならその数だけ
    sessionTotal = Math.min(TOTAL_PER_SESSION, pool.length || TOTAL_PER_SESSION);
    sessionQuestions = shuffle(pool).slice(0, sessionTotal);

    sessionAnswers=[];
    currentIndex=0;
    score=0;
    bestStreak=0;
    currentStreak=0;

    btnSubmit.style.display="block";
    btnNext.style.display="none";
    explanationBox.style.display="none";

    showScreen("quiz");
    renderQuestion();
  }

  // ========= 問題表示 =========
  function renderQuestion() {
    if (!sessionQuestions || !sessionQuestions.length ||
        currentIndex < 0 || currentIndex >= sessionQuestions.length) {
      finishSession();
      return;
    }

    const q = sessionQuestions[currentIndex];
    const total = sessionTotal;

    qCounter.textContent = TEXT.qCounter[lang](currentIndex + 1, total);
    qTopic.textContent   = TOPIC_DEFS[q.topic]?.[lang] || "";
    badgeText.textContent =
      (q.level === "basic" ? TEXT.levelBasic[lang] : TEXT.levelInter[lang]);
    qText.textContent = q.q[lang];

    optionsDiv.innerHTML = "";
    q.choices.forEach((c, idx) => {
      const btn = document.createElement("button");
      btn.className = "opt-btn";
      btn.dataset.index = idx;

      const letter = document.createElement("span");
      letter.className = "letter";
      letter.textContent = String.fromCharCode(65 + idx) + ".";
      const txt = document.createElement("span");
      txt.textContent = c[lang];

      btn.appendChild(letter);
      btn.appendChild(txt);

      btn.onclick = () => {
        if (btnSubmit.disabled) return;
        Array.from(optionsDiv.children).forEach(b =>
          b.classList.remove("selected")
        );
        btn.classList.add("selected");
      };

      optionsDiv.appendChild(btn);
    });

    explanationBox.style.display = "none";
    expBody.textContent = "";

    const prog = Math.round((currentIndex / total) * 100);
    progressBar.style.width = prog + "%";

    statCorrect.textContent = TEXT.statCorrect[lang] + ": " + score;
    const answered = sessionAnswers.length;
    const acc = answered ? Math.round(score / answered * 100) : 0;
    statAccuracy.textContent = TEXT.statAccuracy[lang] + ": " + acc + "%";
  }

  // ========= 回答・次へ =========
  btnSubmit.onclick = () => {
    const q = sessionQuestions[currentIndex];
    if (!q) return;

    const selected = Array.from(optionsDiv.children)
      .find(b => b.classList.contains("selected"));
    if (!selected) return;

    const chosen   = Number(selected.dataset.index);
    const isCorrect = chosen === q.correct;

    try {
      if (isCorrect) {
        score++;
        currentStreak++;
        if (currentStreak > bestStreak) bestStreak = currentStreak;
      } else {
        currentStreak = 0;
      }

      sessionAnswers.push({
        index: currentIndex,
        chosen,
        correct: q.correct,
        id: q.id
      });

      Array.from(optionsDiv.children).forEach((b, idx) => {
        b.onclick = null;
        if (idx === q.correct) b.classList.add("correct");
        if (idx === chosen && idx !== q.correct) b.classList.add("wrong");
      });

      const tag = document.createElement("span");
      tag.className = "state-tag";
      tag.textContent = isCorrect
        ? TEXT.correctLabel[lang]
        : TEXT.wrongLabel[lang];
      selected.appendChild(tag);

      explanationBox.style.display = "block";
      expTitle.textContent = TEXT.expTitle[lang];
      const explanation =
        q.exp && (q.exp[lang] || q.exp.ja || q.exp.en) || "";
      expBody.textContent = explanation;

      statCorrect.textContent =
        TEXT.statCorrect[lang] + ": " + score;
      const acc = Math.round(score / sessionAnswers.length * 100);
      statAccuracy.textContent =
        TEXT.statAccuracy[lang] + ": " + acc + "%";
    } finally {
      btnSubmit.style.display = "none";
      btnNext.style.display   = "block";
    }
  };

  btnNext.onclick = () => {
    const total = sessionTotal;

    if (currentIndex < total - 1) {
      currentIndex++;

      btnSubmit.style.display = "block";
      btnNext.style.display   = "none";
      explanationBox.style.display = "none";

      renderQuestion();
      window.scrollTo({ top: 0, behavior: "smooth" });
    } else {
      finishSession();
    }
  };

  // ========= 結果 =========
  function finishSession(){
    const percent = Math.round(score / sessionTotal * 100);
    const wrong   = sessionTotal - score;

    const wrongIds=sessionAnswers.filter(a=>a.chosen!==a.correct).map(a=>a.id);
    localStorage.setItem("bio_last_wrong_ids",JSON.stringify(wrongIds));
    localStorage.setItem("bio_last_score",String(percent));
    localStorage.setItem("bio_last_date",new Date().toISOString());

    renderResult();
    showScreen("result");
    updateLastSession();
  }

  function renderResult(){
    const percent = Math.round(score / sessionTotal * 100);
    const wrong   = sessionTotal - score;

    resultTitle.textContent   = TEXT.resultTitle[lang];
    resultSummary.textContent =
      TEXT.resultSummary[lang](score, percent, selectedTopic, selectedLevel, sessionTotal);
    resultDetail1.textContent = TEXT.resultDetail1[lang](bestStreak);
    resultDetail2.textContent = TEXT.resultDetail2[lang](wrong);

    reviewList.innerHTML="";
    const missed=sessionAnswers.filter(a=>a.chosen!==a.correct);
    if(missed.length){
      reviewTitle.textContent = TEXT.reviewTitle[lang];
      missed.forEach(m=>{
        const q=sessionQuestions[m.index];
        const li=document.createElement("li");
        const qd=document.createElement("div"); qd.textContent=q.q[lang];
        const yd=document.createElement("div"); yd.className="tag-wrong";
        yd.textContent=TEXT.tagYour[lang]+": "+q.choices[m.chosen][lang];
        const cd=document.createElement("div"); cd.className="tag-correct";
        cd.textContent="正解: "+q.choices[q.correct][lang];
        const ed=document.createElement("div"); ed.className="tag-exp";
        ed.textContent=TEXT.expTitle[lang]+": "+q.exp[lang];
        li.appendChild(qd);li.appendChild(yd);li.appendChild(cd);li.appendChild(ed);
        reviewList.appendChild(li);
      });
      reviewCard.style.display="block";
      btnRestartReview.disabled=false;
    }else{
      reviewCard.style.display="none";
      btnRestartReview.disabled=true;
    }
  }

  // ========= ボタンイベント =========
  btnStartMain.onclick   = ()=>startSession("main");
  btnRestartMain.onclick = ()=>startSession("main");
  btnStartReview.onclick = ()=>startSession("review");
  btnRestartReview.onclick = ()=>startSession("review");
  btnBackHome.onclick    = ()=>showScreen("home");
  btnQuitHome.onclick    = ()=>showScreen("home");

  // 初期化
  renderTopicButtons();
  renderDiffButtons();
  applyLanguage();
  updateLastSession();
</script>
</body>
</html>
